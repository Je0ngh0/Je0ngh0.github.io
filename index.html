<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ê²Œì„</title>
  <meta name="description" content="ê²Œì„" />
  <meta name="theme-color" content="#111827" />
  <style>
    :root {
      /* ê¸°ë³¸(ë‹¤í¬) íŒ”ë ˆíŠ¸ */
      --bg: #0b1020;
      --panel: #111827;
      --panel-2: #0f172a;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --accent: #60a5fa;
      --accent-2: #34d399;
      --warn: #f59e0b;
      --danger: #ef4444;
      --ring: #1f2937;
      --shadow: 0 10px 25px rgba(0,0,0,.4);
      --radius: 16px;
    }
    /* ê°•ì œ ë‹¤í¬/ë¼ì´íŠ¸ í…Œë§ˆ â€” ë²„íŠ¼ìœ¼ë¡œ ì „í™˜ ì‹œ OS ì„ í˜¸ë³´ë‹¤ ìš°ì„  ì ìš© */
    :root[data-theme='dark'] {
      --bg: #0b1020;
      --panel: #111827;
      --panel-2: #0f172a;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --ring: #1f2937;
      --shadow: 0 10px 25px rgba(0,0,0,.4);
    }
    :root[data-theme='light'] {
      --bg: #f8fafc;
      --panel: #ffffff;
      --panel-2: #f1f5f9;
      --text: #0f172a;
      --muted: #475569;
      --ring: #e2e8f0;
      --shadow: 0 8px 20px rgba(2,6,23,.08);
    }
    /* ìë™: OS ì„ í˜¸ë¥¼ ë”°ë¥´ë˜, data-theme='auto' ì¼ ë•Œë§Œ ë³€ê²½ */
    :root[data-theme='auto'] { /* ê¸°ë³¸ì€ ë‹¤í¬ê°’(ìœ„ :root) */ }
    @media (prefers-color-scheme: light) {
      :root[data-theme='auto'] {
        --bg: #f8fafc;
        --panel: #ffffff;
        --panel-2: #f1f5f9;
        --text: #0f172a;
        --muted: #475569;
        --ring: #e2e8f0;
        --shadow: 0 8px 20px rgba(2,6,23,.08);
      }
    }
    }
    html, body { height: 100%; }
    body {
      margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, Helvetica, Arial, "Apple SD Gothic Neo", "Malgun Gothic", sans-serif;
      background: radial-gradient(1200px 700px at 70% -10%, #1f2937 0%, var(--bg) 60%) fixed;
      color: var(--text);
    }
    .container {
      max-width: 1100px; margin: 0 auto; padding: 20px; box-sizing: border-box;
      display: grid; gap: 16px;
      grid-template-columns: 1fr; grid-auto-rows: min-content;
    }
    header.hero {
      display:flex; gap: 12px; align-items:center; justify-content: space-between;
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,0));
      padding: 14px 16px; border-radius: var(--radius);
      border: 1px solid var(--ring); box-shadow: var(--shadow);
    }
    .title { display:flex; gap: 10px; align-items:center; }
    .title h1 { font-size: clamp(18px, 3vw, 24px); margin: 0; }
    .badge { font-size: 12px; padding: 4px 8px; border-radius: 999px; background: var(--panel-2); border: 1px solid var(--ring); color: var(--muted); }
    .controls { display:flex; gap: 8px; align-items:center; flex-wrap: wrap; }
    button, .btn {
      -webkit-tap-highlight-color: transparent;
      appearance: none; border: 1px solid var(--ring); color: var(--text);
      background: linear-gradient(180deg, var(--panel), var(--panel-2));
      padding: 10px 14px; border-radius: 12px; cursor: pointer; transition: transform .04s ease, border-color .2s ease, background .2s ease;
      box-shadow: var(--shadow); font-weight: 600; letter-spacing: .2px;
    }
    button:active { transform: translateY(1px) scale(.99); }
    button[disabled] { opacity: .55; cursor: not-allowed; }
    .btn-accent { border-color: rgba(96,165,250,.5); }
    .btn-green { border-color: rgba(52,211,153,.5); }
    .btn-warn { border-color: rgba(245,158,11,.5); }
    .btn-danger { border-color: rgba(239,68,68,.5); }

    .grid { display:grid; gap: 12px; }
    .grid.cols-2 { grid-template-columns: repeat(2, 1fr); }
    .grid.cols-3 { grid-template-columns: repeat(3, 1fr); }
    .grid.responsive { grid-template-columns: repeat(12, 1fr); }

    .card { background: linear-gradient(180deg, var(--panel), var(--panel-2)); border: 1px solid var(--ring); border-radius: var(--radius); padding: 14px; box-shadow: var(--shadow); }
    .card h3 { margin: 0 0 8px; font-size: 16px; color: var(--muted); font-weight: 700; letter-spacing: .3px; }
    .stat { display:flex; align-items:center; justify-content: space-between; gap: 8px; }
    .stat .label { font-size: 12px; color: var(--muted); }
    .stat .value { font-weight: 800; font-size: clamp(18px, 4vw, 24px); }
    .muted { color: var(--muted); }

    .tabbar { display:flex; gap: 8px; flex-wrap: wrap; }
    .tabbar button[aria-selected="true"] { outline: 2px solid var(--accent); }

    .buy-amount { display:flex; gap: 6px; }
    .buy-amount button { padding: 6px 10px; font-size: 12px; }

    .progress {
      height: 10px; background: #0b1328; border: 1px solid var(--ring); border-radius: 999px; overflow:hidden;
    }
    .progress > span { display:block; height: 100%; background: linear-gradient(90deg, var(--accent), var(--accent-2)); width: 0%; transition: width .6s cubic-bezier(.22,1,.36,1); }

    .two-col { display: grid; grid-template-columns: 1.3fr .7fr; gap: 12px; }

    @media (max-width: 900px) { .two-col { grid-template-columns: 1fr; } }

    .list { display:flex; flex-direction: column; gap: 10px; }
    .row { display:flex; align-items:center; justify-content: space-between; gap: 8px; }
    .row .mini { font-size: 12px; }

    .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; font-size: 12px; background: #0b1328; border: 1px solid var(--ring); padding: 2px 6px; border-radius: 6px; color: var(--muted); }

    .footer { text-align:center; color: var(--muted); font-size: 12px; padding: 20px 4px 60px; }

    .toast { position: fixed; left: 50%; bottom: 24px; transform: translateX(-50%); background: var(--panel); border: 1px solid var(--ring); padding: 10px 14px; border-radius: 10px; box-shadow: var(--shadow); color: var(--text); display:none; z-index: 50; }

    .hidden { display:none !important; }
    .right { text-align:right; }

    /* Large tap targets for mobile */
    .lg-tap { padding: 14px 16px; font-size: 16px; }

    /* Link look */
    .link { color: var(--accent); text-decoration: none; border-bottom: 1px dashed rgba(96,165,250,.4); }
    .link:hover { border-bottom-color: var(--accent); }
  </style>
</head>
<body>
  <div class="container">
    <header class="hero">
      <div class="title">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 2l2.39 4.84L20 8l-4 3.9.94 5.48L12 15.77 7.06 17.38 8 13 4 8l5.61-.16L12 2z" fill="currentColor" opacity=".9"/></svg>
        <h1>ê°•í™” Â· í™˜ìƒ Â· ë³´ìƒ â€” ìŠ¤í‚µ ê²Œì„</h1>
        <span class="badge">v1.0</span>
      </div>
      <div class="controls">
        <button id="themeToggle" class="btn" title="í…Œë§ˆ ì „í™˜" aria-label="í…Œë§ˆ ì „í™˜">ğŸŒ“</button>
        <button id="saveBtn" class="btn" aria-label="ì €ì¥">ì €ì¥</button>
        <button id="exportBtn" class="btn" aria-label="ë‚´ë³´ë‚´ê¸°">ë‚´ë³´ë‚´ê¸°</button>
        <label class="kbd" title="ìë™ ì €ì¥">ìë™ ì €ì¥</label>
      </div>
    </header>

    <!-- STATS BAR -->
    <section class="grid cols-3" style="grid-template-columns: repeat(3, minmax(0, 1fr));">
      <div class="card stat"><div>
        <div class="label">ë³´ìœ  ê³¨ë“œ</div>
        <div id="goldLabel" class="value">0</div></div>
        <div class="right muted mini">GPS <span id="gpsLabel">0</span></div></div>
      <div class="card stat"><div>
        <div class="label">ê°•í™” ë ˆë²¨</div>
        <div id="levelLabel" class="value">0</div></div>
        <div class="right muted mini">ë°°ìˆ˜ <span id="multLabel">x1.00</span></div></div>
      <div class="card stat"><div>
        <div class="label">í™˜ìƒì„ Â· ìŠ¤í‚µí† í°</div>
        <div class="value"><span id="stoneLabel">0</span>ì„ Â· <span id="tokenLabel">0</span>ê°œ</div></div>
        <div class="right muted mini">ìµœê³  ë ˆë²¨ <span id="bestLabel">0</span></div></div>
    </section>

    <!-- TABS -->
    <nav class="tabbar">
      <button class="btn btn-accent lg-tap" data-tab="upgrade" aria-selected="true">âš”ï¸ ê°•í™”</button>
      <button class="btn btn-green lg-tap" data-tab="rewards">ğŸ ë³´ìƒ</button>
      <button class="btn btn-warn lg-tap" data-tab="rebirth">â™»ï¸ í™˜ìƒ</button>
      <button class="btn lg-tap" data-tab="settings">âš™ï¸ ì„¤ì •/ë„ì›€ë§</button>
    </nav>

    <!-- TAB PANES -->
    <main class="two-col">
      <!-- LEFT: MAIN CONTENT PER TAB -->
      <section id="tab-upgrade" class="card">
        <h3>ê°•í™”</h3>
        <div class="list">
          <div class="row">
            <div>
              <div class="muted mini">êµ¬ë§¤ ìˆ˜ëŸ‰</div>
              <div class="buy-amount">
                <button class="btn" data-buy="1">x1</button>
                <button class="btn" data-buy="10">x10</button>
                <button class="btn" data-buy="100">x100</button>
              </div>
            </div>
            <div class="right">
              <div class="muted mini">ë‹¤ìŒ ë¹„ìš©</div>
              <div id="nextCost" class="value" style="font-size:18px">0</div>
            </div>
          </div>

          <button id="upgradeBtn" class="btn btn-accent lg-tap" style="width:100%">
            ë ˆë²¨ ì˜¬ë¦¬ê¸° (+ê³µê²©/ìˆ˜ìµ) â€” <span id="buyLabel">x1</span>
          </button>

          <div>
            <div class="muted mini">ì§„í–‰ë„ (ë‹¤ìŒ ë§ˆì¼ìŠ¤í†¤ê¹Œì§€)</div>
            <div class="progress" aria-label="ë§ˆì¼ìŠ¤í†¤ ì§„í–‰ë„"><span id="milestoneBar" style="width:0%"></span></div>
            <div class="row mini muted"><span>ë§ˆì¼ìŠ¤í†¤: 25ë ˆë²¨ ë‹¨ìœ„ë¡œ ìŠ¤í‚µ í† í° íšë“</span><span><span id="milestoneInfo">0</span> / 25</span></div>
          </div>

          <hr style="border:0;border-top:1px solid var(--ring)">

          <h3>ê°•í™” ìŠ¤í‚µ (ë³´ìƒ ì‚¬ìš©)</h3>
          <div class="grid cols-3">
            <button class="btn btn-green" data-skip="1">ìŠ¤í‚µ +5ë ˆë²¨ (í† í° 1)</button>
            <button class="btn btn-green" data-skip="5">ìŠ¤í‚µ +25ë ˆë²¨ (í† í° 5)</button>
            <button class="btn btn-green" data-skip="10">ìŠ¤í‚µ +50ë ˆë²¨ (í† í° 10)</button>
          </div>
          <div class="muted mini">ìŠ¤í‚µì€ ê³¨ë“œ ë¹„ìš© ì—†ì´ ë ˆë²¨ì„ ì¦‰ì‹œ ì˜¬ë¦½ë‹ˆë‹¤. 1í† í°ë‹¹ 5ë ˆë²¨ ìƒìŠ¹.</div>

          <hr style="border:0;border-top:1px solid var(--ring)">

          <h3>ìˆ˜ë™ ìˆ˜ìµ (í´ë¦­)</h3>
          <button id="clickBtn" class="btn lg-tap" style="width:100%">íƒ­/í´ë¦­í•˜ì—¬ ê³¨ë“œ íšë“</button>
          <div class="row mini muted"><span>í´ë¦­ë‹¹ ìˆ˜ìµ: <span id="cpcLabel">1</span></span><span>ìë™ìˆ˜ìµ(GPS): <span id="gpsLabel2">0</span></span></div>
        </div>
      </section>

      <!-- RIGHT: SIDE PANELS PER TAB -->
      <aside id="tab-rewards" class="card hidden">
        <h3>ë³´ìƒ</h3>
        <div class="list">
          <div class="card" style="background:transparent; border-style:dashed">
            <div class="row">
              <div>
                <div class="muted mini">ë¬´ë£Œ ë³´ìƒ (ì¿¨ë‹¤ìš´)</div>
                <div><strong>ìŠ¤í‚µ í† í° 1</strong> + ê³¨ë“œ ì•½ê°„</div>
              </div>
              <button id="claimFreeBtn" class="btn btn-green">ë°›ê¸°</button>
            </div>
            <div class="mini muted">ë‹¤ìŒ ìˆ˜ë ¹ ê°€ëŠ¥: <span id="freeTimer">ì§€ê¸ˆ</span></div>
          </div>

          <div class="card" style="background:transparent; border-style:dashed">
            <div class="row"><strong>ë¯¸ì…˜</strong><span class="mini muted">ë‹¬ì„± ì‹œ ìŠ¤í‚µ í† í° ì§€ê¸‰</span></div>
            <div class="list" id="missionList"></div>
          </div>

          <div class="card" style="background:transparent; border-style:dashed">
            <div class="row"><strong>ë§ˆì¼ìŠ¤í†¤ ìƒì</strong><span class="mini muted">25ë ˆë²¨ë§ˆë‹¤ ìë™ ì§€ê¸‰</span></div>
            <div class="mini muted">ì§€ê¸ˆê¹Œì§€ íšë“í•œ ë§ˆì¼ìŠ¤í†¤: <span id="milestoneCount">0</span>íšŒ</div>
          </div>
        </div>
      </aside>

      <aside id="tab-rebirth" class="card hidden">
        <h3>í™˜ìƒ</h3>
        <div class="list">
          <div class="row">
            <div>
              <div class="muted mini">í™˜ìƒ ì„¤ëª…</div>
              <div>í™˜ìƒì„ í•˜ë©´ <strong>ê³¨ë“œ, ë ˆë²¨</strong>ì´ ì´ˆê¸°í™”ë˜ê³  <strong>í™˜ìƒì„</strong>ì„ íšë“í•©ë‹ˆë‹¤. í™˜ìƒì„ 1ê°œë§ˆë‹¤ ìˆ˜ìµì´ <strong>+10%</strong> ì˜êµ¬ ìƒìŠ¹í•©ë‹ˆë‹¤.</div>
            </div>
          </div>
          <div class="row">
            <div>
              <div class="muted mini">ì´ë²ˆ í™˜ìƒ ë³´ìƒ (í˜„ì¬ ë ˆë²¨ ê¸°ì¤€)</div>
              <div class="value" id="rebirthPreview">0 ì„</div>
            </div>
            <button id="rebirthBtn" class="btn btn-warn lg-tap">í™˜ìƒí•˜ê¸°</button>
          </div>
          <div class="mini muted">ê³µì‹: âŒŠí˜„ì¬ ë ˆë²¨ / 50âŒ‹ ì„</div>
        </div>
      </aside>

      <aside id="tab-settings" class="card hidden">
        <h3>ì„¤ì • & ë„ì›€ë§</h3>
        <div class="list">
          <div class="row"><div><strong>í…Œë§ˆ</strong><div class="mini muted">ì‹œìŠ¤í…œ/ë¼ì´íŠ¸/ë‹¤í¬</div></div>
            <div class="row" style="gap:6px">
              <button class="btn" data-theme="auto">ì‹œìŠ¤í…œ</button>
              <button class="btn" data-theme="light">ë¼ì´íŠ¸</button>
              <button class="btn" data-theme="dark">ë‹¤í¬</button>
            </div>
          </div>

          <div class="card" style="background:transparent; border-style:dashed">
            <div class="row"><strong>ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°</strong><span class="mini muted">ë¸Œë¼ìš°ì €ì— ìë™ ì €ì¥ë©ë‹ˆë‹¤.</span></div>
            <div class="grid cols-3">
              <button id="importBtn" class="btn">ë¶ˆëŸ¬ì˜¤ê¸°</button>
              <button id="downloadBtn" class="btn">íŒŒì¼ë¡œ ë‚´ë³´ë‚´ê¸°</button>
              <button id="hardResetBtn" class="btn btn-danger">ì „ì²´ ì´ˆê¸°í™”</button>
            </div>
            <textarea id="ioBox" rows="4" style="width:100%; margin-top:8px; background:#0b1328; color:var(--text); border:1px solid var(--ring); border-radius:8px; padding:8px" placeholder='ì—¬ê¸°ì— ì €ì¥ ë°ì´í„°ë¥¼ ë¶™ì—¬ë„£ê³  "ë¶ˆëŸ¬ì˜¤ê¸°"ë¥¼ ëˆ„ë¥´ì„¸ìš”.'></textarea>
          </div>

          <details class="card" style="background:transparent">
            <summary><strong>ê²Œì„ íŒ</strong></summary>
            <ul class="mini muted" style="line-height:1.6">
              <li>ê°•í™” ë¹„ìš©ì€ ë ˆë²¨ì´ ì˜¤ë¥¼ìˆ˜ë¡ ê¸°í•˜ê¸‰ìˆ˜ì ìœ¼ë¡œ ì¦ê°€í•©ë‹ˆë‹¤. í•„ìš”í•˜ë©´ <strong>ìŠ¤í‚µ í† í°</strong>ìœ¼ë¡œ êµ¬ê°„ì„ ê±´ë„ˆë›°ì„¸ìš”.</li>
              <li>25ë ˆë²¨ë§ˆë‹¤ ìë™ìœ¼ë¡œ ë§ˆì¼ìŠ¤í†¤ í† í°ì„ ì–»ìŠµë‹ˆë‹¤.</li>
              <li>í™˜ìƒì€ ë ˆë²¨ì´ ë†’ì„ìˆ˜ë¡ ë” ë§ì€ í™˜ìƒì„ì„ ì£¼ë©°, ìˆ˜ìµì— ì˜êµ¬ ë°°ìˆ˜ë¥¼ ì œê³µí•©ë‹ˆë‹¤.</li>
            </ul>
          </details>
        </div>
      </aside>
    </main>

    <div class="footer">Made for GitHub Pages Â· í´ë¼ì´ì–¸íŠ¸ ì €ì¥(LocalStorage) Â· ë°˜ì‘í˜• UI</div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script>
    // ===== Utilities =====
    const clamp = (n, a, b) => Math.max(a, Math.min(b, n));
    const format = (n) => {
      if (!isFinite(n)) return 'âˆ';
      const abs = Math.abs(n);
      if (abs < 1000) return n.toFixed(0);
      const units = ['K','M','B','T','Qa','Qi'];
      let u = -1; let v = abs;
      while (v >= 1000 && u < units.length - 1) { v /= 1000; u++; }
      return (Math.sign(n) < 0 ? '-' : '') + v.toFixed(2) + units[u];
    };
    const now = () => Date.now();

    // ===== Game State =====
    const SAVE_KEY = 'skipgame_v1';

    const DefaultState = () => ({
      gold: 0,
      level: 0,
      best: 0,
      stones: 0, // í™˜ìƒì„
      tokens: 0, // ìŠ¤í‚µ í† í°
      buyAmt: 1, // 1/10/100
      nextFreeAt: 0, // ë¬´ë£Œ ë³´ìƒ ê°€ëŠ¥ ì‹œê°(ms)
      missions: { // ë¯¸ì…˜ í´ë ˆì„ ì—¬ë¶€
        L25: false, L50: false, L100: false, L200: false
      },
      milestonesClaimed: 0, // 25ë‹¨ìœ„ ìƒì ì²˜ë¦¬ ê°œìˆ˜
      theme: 'auto',
      lastTick: now(),
    });

    let S = load();

    // ===== Balance / Formulas =====
    const COST_BASE = 10;
    const COST_GROWTH = 1.15; // ê¸°í•˜ ì¦ê°€ë¥ 
    const GPS_PER_LEVEL = 0.5; // ì´ˆë‹¹ ê³¨ë“œ
    const CPC_BASE = 1; // í´ë¦­ ê¸°ë³¸ ê³¨ë“œ
    const CPC_PER_LEVEL = 0.1; // ë ˆë²¨ë‹¹ ì¶”ê°€
    const REBIRTH_RATE = 0.10; // í™˜ìƒì„ 1ê°œë‹¹ 10%

    function multiplier() {
      return 1 + (S.stones * REBIRTH_RATE);
    }

    function nextCostSingle(level) {
      return COST_BASE * Math.pow(COST_GROWTH, level);
    }

    // GP sum for buying n levels at once
    function costFor(level, n) {
      const r = COST_GROWTH;
      const a = nextCostSingle(level);
      if (n === 1) return a;
      return a * (Math.pow(r, n) - 1) / (r - 1);
    }

    function gps() { return S.level * GPS_PER_LEVEL * multiplier(); }
    function cpc() { return (CPC_BASE + S.level * CPC_PER_LEVEL) * multiplier(); }

    function milestonesReached() { return Math.floor(S.level / 25); }

    function stonesGainPreview() { return Math.floor(S.level / 50); }

    // ===== Save/Load =====
    function save() {
      try { localStorage.setItem(SAVE_KEY, JSON.stringify(S)); } catch (e) {}
      S.lastTick = now();
    }
    function load() {
      try {
        const raw = localStorage.getItem(SAVE_KEY);
        if (!raw) return DefaultState();
        const obj = JSON.parse(raw);
        return Object.assign(DefaultState(), obj);
      } catch (e) { return DefaultState(); }
    }

    // ===== UI Refs =====
    const $ = (q) => document.querySelector(q);
    const $$ = (q) => Array.from(document.querySelectorAll(q));

    const goldLabel = $('#goldLabel');
    const gpsLabel = $('#gpsLabel');
    const gpsLabel2 = $('#gpsLabel2');
    const levelLabel = $('#levelLabel');
    const multLabel = $('#multLabel');
    const stoneLabel = $('#stoneLabel');
    const tokenLabel = $('#tokenLabel');
    const bestLabel = $('#bestLabel');
    const buyLabel = $('#buyLabel');
    const nextCostLabel = $('#nextCost');
    const milestoneBar = $('#milestoneBar');
    const milestoneInfo = $('#milestoneInfo');
    const milestoneCount = $('#milestoneCount');
    const cpcLabel = $('#cpcLabel');
    const rebirthPreview = $('#rebirthPreview');
    const freeTimer = $('#freeTimer');

    const toast = $('#toast');

    // ===== Tabs =====
    const tabs = { upgrade: $('#tab-upgrade'), rewards: $('#tab-rewards'), rebirth: $('#tab-rebirth'), settings: $('#tab-settings') };
    $$('.tabbar button').forEach(btn => btn.addEventListener('click', () => selectTab(btn.dataset.tab)));
    function selectTab(name) {
      for (const [k, el] of Object.entries(tabs)) {
        el.classList.toggle('hidden', k !== name);
      }
      $$('.tabbar button').forEach(b => b.setAttribute('aria-selected', String(b.dataset.tab === name)));
    }

    // ===== Buy Amount =====
    $$('.buy-amount button').forEach(btn => btn.addEventListener('click', () => {
      S.buyAmt = parseInt(btn.dataset.buy);
      buyLabel.textContent = 'x' + S.buyAmt;
      showToast(`êµ¬ë§¤ ìˆ˜ëŸ‰ì´ x${S.buyAmt} ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.`);
      refreshCosts(); save();
    }));

    // ===== Upgrade =====
    $('#upgradeBtn').addEventListener('click', () => {
      const n = S.buyAmt;
      const cost = costFor(S.level, n);
      if (S.gold >= cost) {
        S.gold -= cost;
        S.level += n;
        S.best = Math.max(S.best, S.level);
        processMilestones();
        refreshAll(); save();
      } else {
        showToast('ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.');
      }
    });

    // ===== Click Income =====
    $('#clickBtn').addEventListener('click', () => {
      S.gold += cpc();
      refreshGold(); save();
    });

    // ===== Skip with Tokens =====
    $$('button[data-skip]').forEach(btn => btn.addEventListener('click', () => {
      const t = parseInt(btn.dataset.skip); // tokens to spend
      if (S.tokens < t) return showToast('ìŠ¤í‚µ í† í°ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.');
      const levels = t * 5;
      S.tokens -= t;
      S.level += levels;
      S.best = Math.max(S.best, S.level);
      processMilestones();
      showToast(`ìŠ¤í‚µ ì„±ê³µ! ë ˆë²¨ +${levels}`);
      refreshAll(); save();
    }));

    // ===== Free Reward (Cooldown) =====
    const FREE_CD_MS = 5 * 60 * 1000; // 5ë¶„
    $('#claimFreeBtn').addEventListener('click', () => {
      const t = now();
      if (t < S.nextFreeAt) return showToast('ì•„ì§ ì¿¨ë‹¤ìš´ì…ë‹ˆë‹¤.');
      S.tokens += 1;
      S.gold += 25 * multiplier();
      S.nextFreeAt = t + FREE_CD_MS;
      showToast('ë¬´ë£Œ ë³´ìƒ ì§€ê¸‰: ìŠ¤í‚µ í† í° 1, ê³¨ë“œ +ë³´ë„ˆìŠ¤');
      refreshAll(); save();
    });

    // ===== Missions =====
    const MISSIONS = [
      { id: 'L25', name: 'ë ˆë²¨ 25 ë‹¬ì„±', need: 25, reward: 2 },
      { id: 'L50', name: 'ë ˆë²¨ 50 ë‹¬ì„±', need: 50, reward: 5 },
      { id: 'L100', name: 'ë ˆë²¨ 100 ë‹¬ì„±', need: 100, reward: 12 },
      { id: 'L200', name: 'ë ˆë²¨ 200 ë‹¬ì„±', need: 200, reward: 30 },
    ];

    const missionList = $('#missionList');
    function renderMissions() {
      missionList.innerHTML = '';
      MISSIONS.forEach(m => {
        const done = S.level >= m.need;
        const claimed = !!S.missions[m.id];
        const row = document.createElement('div');
        row.className = 'row';
        row.innerHTML = `<div><div><strong>${m.name}</strong></div><div class="mini muted">ë³´ìƒ: ìŠ¤í‚µ í† í° ${m.reward}ê°œ</div></div>`;
        const btn = document.createElement('button');
        btn.className = 'btn btn-green';
        btn.textContent = claimed ? 'ì™„ë£Œë¨' : (done ? 'ë°›ê¸°' : 'ë¯¸ì™„ë£Œ');
        btn.disabled = claimed || !done;
        btn.addEventListener('click', () => {
          if (btn.disabled) return;
          S.tokens += m.reward; S.missions[m.id] = true; save();
          showToast(`${m.name} â€” ë³´ìƒ ìˆ˜ë ¹! (+${m.reward} í† í°)`);
          renderMissions(); refreshTokens();
        });
        row.appendChild(btn);
        missionList.appendChild(row);
      });
    }

    // ===== Milestones (every 25 levels) =====
    function processMilestones() {
      const reached = milestonesReached();
      if (reached > S.milestonesClaimed) {
        const gain = reached - S.milestonesClaimed; // new boxes
        S.tokens += gain; S.milestonesClaimed = reached;
        showToast(`ë§ˆì¼ìŠ¤í†¤ ë³´ìƒ: ìŠ¤í‚µ í† í° +${gain}`);
      }
    }

    // ===== Rebirth =====
    $('#rebirthBtn').addEventListener('click', () => {
      const gain = stonesGainPreview();
      if (gain <= 0) return showToast('í™˜ìƒ ë³´ìƒì´ ì—†ìŠµë‹ˆë‹¤. ì¢€ ë” ì§„í–‰í•´ë³´ì„¸ìš”!');
      if (!confirm(`í™˜ìƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ë²ˆ í™˜ìƒìœ¼ë¡œ í™˜ìƒì„ ${gain}ê°œë¥¼ íšë“í•©ë‹ˆë‹¤.`)) return;
      S.stones += gain;
      S.gold = 0; S.level = 0; S.best = 0; S.milestonesClaimed = 0;
      showToast(`í™˜ìƒ ì™„ë£Œ! í™˜ìƒì„ +${gain} (ì´ ${S.stones})`);
      refreshAll(); save();
    });

    // ===== Theme =====
    const themeRoot = document.documentElement;
    function applyTheme(t) {
      S.theme = t; save();
      themeRoot.dataset.theme = t;
      if (t === 'light') {
        themeRoot.style.setProperty('color-scheme', 'light');
      } else if (t === 'dark') {
        themeRoot.style.setProperty('color-scheme', 'dark');
      } else {
        themeRoot.style.removeProperty('color-scheme');
      }
    }
    $('#themeToggle').addEventListener('click', () => {
      const next = S.theme === 'auto' ? 'dark' : S.theme === 'dark' ? 'light' : 'auto';
      applyTheme(next);
      showToast(`í…Œë§ˆ: ${next}`);
    });
    $$('button[data-theme]').forEach(b => b.addEventListener('click', () => applyTheme(b.dataset.theme)));

    // ===== Save/Load Buttons =====
    $('#saveBtn').addEventListener('click', () => { save(); showToast('ì €ì¥ ì™„ë£Œ'); });
    $('#exportBtn').addEventListener('click', () => {
      const data = btoa(unescape(encodeURIComponent(JSON.stringify(S))));
      const io = $('#ioBox'); io.value = data; io.select(); document.execCommand('copy');
      showToast('í´ë¦½ë³´ë“œë¡œ ë‚´ë³´ëƒˆìŠµë‹ˆë‹¤. (ì„¤ì • íƒ­ì—ì„œ íŒŒì¼ë¡œ ì €ì¥ ê°€ëŠ¥)');
    });
    $('#importBtn').addEventListener('click', () => {
      const txt = $('#ioBox').value.trim(); if (!txt) return showToast('ë¶ˆëŸ¬ì˜¬ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
      try {
        const obj = JSON.parse(decodeURIComponent(escape(atob(txt))));
        S = Object.assign(DefaultState(), obj); save(); refreshAll();
        showToast('ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ');
      } catch (e) { showToast('í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.'); }
    });
    $('#downloadBtn').addEventListener('click', () => {
      const blob = new Blob([JSON.stringify(S)], {type:'application/json'});
      const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'skip-game-save.json'; a.click(); URL.revokeObjectURL(a.href);
    });
    $('#hardResetBtn').addEventListener('click', () => {
      if (!confirm('ì •ë§ë¡œ ì „ì²´ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì €ì¥ ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤.')) return;
      S = DefaultState(); save(); refreshAll(); showToast('ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
    });

    // ===== Ticker =====
    function tick() {
      const t = now();
      const dt = clamp((t - S.lastTick) / 1000, 0, 5); // seconds, clamp for idle
      S.gold += gps() * dt; // ì•„ì´ë“¤ ìˆ˜ìµ
      S.lastTick = t;
      refreshGold();
      refreshFreeTimer();
      window.requestAnimationFrame(tick);
    }

    // ===== UI Refresh =====
    function refreshGold() {
      goldLabel.textContent = format(S.gold);
    }
    function refreshStats() {
      gpsLabel.textContent = gps().toFixed(2);
      gpsLabel2.textContent = gps().toFixed(2);
      cpcLabel.textContent = cpc().toFixed(2);
      levelLabel.textContent = S.level;
      multLabel.textContent = 'x' + multiplier().toFixed(2);
      stoneLabel.textContent = S.stones;
      tokenLabel.textContent = S.tokens;
      bestLabel.textContent = S.best;
      rebirthPreview.textContent = stonesGainPreview() + ' ì„';
      milestoneCount.textContent = S.milestonesClaimed;
    }
    function refreshCosts() {
      buyLabel.textContent = 'x' + S.buyAmt;
      nextCostLabel.textContent = format(costFor(S.level, S.buyAmt));
      const within = S.level % 25; const left = 25 - within;
      milestoneInfo.textContent = within + ' / 25';
      milestoneBar.style.width = ((within / 25) * 100).toFixed(1) + '%';
    }
    function refreshTokens() { tokenLabel.textContent = S.tokens; }

    function refreshFreeTimer() {
      const t = now();
      if (t >= S.nextFreeAt) { freeTimer.textContent = 'ì§€ê¸ˆ'; $('#claimFreeBtn').disabled = false; }
      else {
        const s = Math.ceil((S.nextFreeAt - t)/1000);
        const m = Math.floor(s/60), r = s % 60;
        freeTimer.textContent = `${m}ë¶„ ${r}ì´ˆ í›„`; $('#claimFreeBtn').disabled = true;
      }
    }

    function refreshAll() { refreshGold(); refreshStats(); refreshCosts(); renderMissions(); refreshFreeTimer(); }

    // ===== Toast =====
    let toastTimer = null;
    function showToast(msg) {
      toast.textContent = msg; toast.style.display = 'block';
      clearTimeout(toastTimer); toastTimer = setTimeout(() => toast.style.display = 'none', 1800);
    }

    // ===== Init =====
    (function init(){
      // default cooldown ready on first run
      if (!S.nextFreeAt) S.nextFreeAt = now();
      // theme
      applyTheme(S.theme || 'auto');
      // prime UI
      refreshAll();
      // start loop
      window.requestAnimationFrame(tick);
    })();
  </script>
</body>
</html>
